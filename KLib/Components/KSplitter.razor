@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<div @attributes="InputAttributes" class="k-splitter">
    <div id="@FirstId" class="k-splitter-first">
        @FirstChild
    </div>
    <div id="@SecondId" class="k-splitter-second">
        @SecondChild
    </div>
</div>

<style>
    .k-splitter {
        flex-direction: @(Orientation == KSplitterOrientation.Horizontal ? "row" : "column");
    }

    .gutter {
        background-color: rgb(var(--bs-tertiary-bg-rgb)) !important;
        background-repeat: no-repeat;
        background-position: 50%;
    }

    .gutter.gutter-horizontal {
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
        cursor: @(Orientation == KSplitterOrientation.Horizontal ? "ew-resize" : "ns-resize");
    }

</style>

<script>
    function initSplit(firstId, secondId, firstWidthPercent, secondWidthPercent) {
        Split(["#" + firstId, "#" + secondId], {
            gutterSize: 3,
            sizes: [firstWidthPercent, secondWidthPercent]
        });
    }
</script>

@code {

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? InputAttributes { get; set; }

    [Parameter] [EditorRequired] public RenderFragment FirstChild { get; set; } = null!;
    [Parameter] [EditorRequired] public RenderFragment SecondChild { get; set; } = null!;

    [Parameter] public int? FirstChildWidthPercent { get; set; }
    [Parameter] public int? SecondChildWidthPercent { get; set; }

    [Parameter] public string FirstId { get; set; } = "a" + Guid.NewGuid().ToString();
    [Parameter] public string SecondId { get; set; } = "a" + Guid.NewGuid().ToString();

    [Parameter] public KSplitterOrientation Orientation { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            int firstWidth = 0;
            int secondWidth = 0;
            if (FirstChildWidthPercent.HasValue && SecondChildWidthPercent.HasValue)
            {
                firstWidth = FirstChildWidthPercent.Value;
                secondWidth = SecondChildWidthPercent.Value;
            }
            else if (FirstChildWidthPercent.HasValue)
            {
                firstWidth = FirstChildWidthPercent.Value;
                secondWidth = 100 - firstWidth;
            }
            else if (SecondChildWidthPercent.HasValue)
            {
                secondWidth = SecondChildWidthPercent.Value;
                firstWidth = 100 - secondWidth;
            }
            else
            {
                firstWidth = 50;
                secondWidth = 50;
            }

            await JSRuntime.InvokeVoidAsync("initSplit", FirstId, SecondId, firstWidth, secondWidth);
        }
    }

    public enum KSplitterOrientation
    {
        Horizontal,
        Vertical
    }

}

